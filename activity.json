{
  "tasks": {
    "task-061": {
      "title": "Restrict subdomains to paid plans only",
      "status": "completed",
      "priority": "high",
      "description": "Subdomains should require a paid (PRO) account. Free users can only use path-based URLs. Also restrict subdomains shorter than 6 characters to PRO+ only.",
      "completedAt": "2025-02-19",
      "notes": "Fixed field name mismatches: projectDescription -> whatBuilding, referralCode -> referredBy"
      "successCriteria": [
        "Free tier users cannot claim subdomains - only get path-based URLs (/a/{slug})",
        "PRO tier and above can claim subdomains",
        "Subdomains with < 6 characters require PRO+ (e.g., 'app' blocked, 'myapp' allowed)",
        "Update pricing page to reflect subdomain restriction",
        "Existing subdomain reservations from free users should be released on next publish attempt"
      ],
      "notes": "Integrated with feature flag system. Free users blocked from subdomains, PRO required for regular subdomains, BUSINESS required for short subdomains (<6 chars)."
    },
    "task-063": {
      "title": "Fix waitlist/signup form validation bug",
      "status": "completed",
      "priority": "high",
      "description": "Users trying to sign up are seeing email and description as required errors even though they filled them in. Need to investigate frontend validation, API payload, and form handling.",
      "successCriteria": [
        "Form submits successfully when all fields are filled",
        "Required field validation works correctly",
        "Error messages are clear and accurate"
      ]
    },
      "title": "Implement feature flag system",
      "status": "completed",
      "priority": "medium",
      "description": "Add a feature flag system to enable/disable features without deploying code. Useful for gradual rollouts, A/B testing, and beta features.",
      "completedAt": "2025-02-19",
      "notes": "Fixed field name mismatches: projectDescription -> whatBuilding, referralCode -> referredBy"
      "notes": "Created: db tables (feature_flags, user_feature_overrides), lib/features.ts with isFeatureEnabled(), rollout %, custom rules, API routes, seed data. All 163 tests pass.",
      "successCriteria": [
        "Database table for feature flags (name, enabled, rollout_percentage, user_tiers)",
        "API endpoint to check feature status for current user",
        "Frontend helper to check if feature is enabled",
        "Support per-plan restrictions (free vs pro features)",
        "Support gradual rollout percentage"
      ],
      "subtasks": [
        {
          "id": "062-01",
          "title": "Create feature_flags table in database",
          "description": "Add SQLite table with columns: id, name, display_name, description, enabled, rollout_percentage, min_plan_tier, custom_rules (JSON), created_at, updated_at. Add unique index on name.",
          "status": "completed"
        },
        {
          "id": "062-02",
          "title": "Create user_feature_overrides table",
          "description": "Add table for per-user overrides: id, user_id, feature_name, enabled, reason, expires_at, created_at. Add FK and unique index.",
          "status": "completed"
        },
        {
          "id": "062-03",
          "title": "Define PLAN_TIERS constant and helper functions",
          "description": "Create PLAN_TIERS constant (FREE=0, HOBBY=1, PRO=2, BUSINESS=3) and isPlanAtLeast() helper for comparing plan tiers.",
          "status": "completed"
        },
        {
          "id": "062-04",
          "title": "Create lib/features.ts module",
          "description": "Build core module with: getFeatureFlag(), isFeatureEnabled(), checkCustomRules(). Decision logic: global enabled → rollout % → plan tier → custom rules → user overrides.",
          "status": "completed"
        },
        {
          "id": "062-05",
          "title": "Implement rollout percentage logic",
          "description": "Add deterministic rollout based on user ID hash (userId hash mod 100). Same user always gets same result.",
          "status": "completed"
        },
        {
          "id": "062-06",
          "title": "Implement custom rules engine",
          "description": "Support JSON rules with conditions: subdomain_length, account_age_days, has_apps. Operators: <, <=, >, >=, ==, !=.",
          "status": "completed"
        },
        {
          "id": "062-07",
          "title": "Create feature flag CRUD functions",
          "description": "Implement: createFeatureFlag, updateFeatureFlag, deleteFeatureFlag, listFeatureFlags, setUserOverride, removeUserOverride.",
          "status": "completed"
        },
        {
          "id": "062-08",
          "title": "Create GET /api/features endpoint",
          "description": "Public endpoint returning all flags with enabled status for current user. Response time < 50ms with caching.",
          "status": "completed"
        },
        {
          "id": "062-09",
          "title": "Create GET /api/features/:name endpoint",
          "description": "Detailed flag status with reason field (plan_tier_met, rollout, user_override, etc.).",
          "status": "completed"
        },
        {
          "id": "062-10",
          "title": "Create admin feature management API",
          "description": "Protected endpoints: POST/PUT/DELETE /api/admin/features, override management. Add audit logging.",
          "status": "completed"
        },
        {
          "id": "062-11",
          "title": "Define subdomains feature flag",
          "description": "Seed feature flag: name='subdomains', min_plan_tier='PRO', enabled=true. Also seed 'short_subdomains' with custom_rules for <6 chars requiring PRO+.",
          "status": "completed"
        },
        {
          "id": "062-12",
          "title": "Update subdomain claiming to use feature flags",
          "description": "Modify src/routes/apps.ts POST /:id/publish to check isFeatureEnabled('subdomains') before allowing subdomain claim. Check custom_rules for short subdomain length.",
          "status": "completed"
        }
      ]
    },
    "task-055": {
      "title": "Fix reset password page routing/logout issue",
      "status": "completed",
      "priority": "high",
      "description": "Reset password page with invalid token shows landing page instead of error message. When logged in, reset-password route may be redirecting incorrectly.",
      "successCriteria": [
        "Reset password page shows token validation state",
        "Invalid token shows error message (not landing page)",
        "Navigation shows correct state (Login vs Logout)"
      ],
      "completedAt": "2025-02-17",
      "notes": "Fixed token parsing to check both hash (SPA routing) and search query (direct URL access). Now handles URLs like /reset-password?token=xyz when accessed directly."
    },
    "task-053": {
      "title": "Fix delete app button not working on mobile",
      "status": "completed",
      "priority": "high",
      "description": "Delete button on app cards does not work on mobile viewports",
      "successCriteria": [
        "Delete button is tappable on mobile",
        "Confirm dialog appears when tapped",
        "App is deleted after confirmation",
        "App list refreshes after deletion"
      ],
      "completedAt": "2025-02-17",
      "notes": "Added event delegation in initMobileNav() to handle data-action buttons (delete-app, edit-app, show-app-analytics). Buttons now use data-action and data-app-id attributes instead of inline onclick."
    },
    "task-056": {
      "title": "Audit Log: Schema + Write Layer",
      "status": "completed",
      "completedAt": "2026-02-19T10:17:00Z",
      "summary": "Added audit_logs table with all required columns (id, user_id, action, resource_type, resource_id, details, ip_address, user_agent, created_at), created index on (user_id, created_at DESC) for fast queries, implemented logAuditEvent() helper function with TypeScript types, and tested with successful record insertion.",
      "commit": "761bdc8"
    },
    "task-057": {
      "title": "Audit Log: Hook into Auth/Apps/Secrets actions",
      "status": "completed",
      "completedAt": "2026-02-19T10:30:00Z",
      "summary": "Added logAuditEvent() calls to auth (login, password_change, password_reset_request, password_reset_complete, account_delete), apps (app_create, app_update, app_delete, app_publish), and secrets (secret_create, secret_update, secret_delete) handlers. Captures IP address and user-agent for all events.",
      "commit": "5f7eef0"
    },
    "task-058": {
      "title": "Audit Log: API Endpoint",
      "status": "completed",
      "completedAt": "2026-02-19T11:00:00Z",
      "summary": "Added GET /api/audit-logs endpoint with pagination (?limit=50&offset=0), filters (?action=login&since=7d), returns logs sorted by created_at DESC.",
      "commit": "f87741d"
    },
    "task-059": {
      "title": "Audit Log: UI (MVP) - Settings Activity Section",
      "status": "completed",
      "completedAt": "2026-02-19T11:10:00Z",
      "summary": "Added Activity section to Settings tab in dashboard showing last 20 events in table format with human-readable action labels and relative timestamps. Load More button for pagination.",
      "commit": "f87741d"
    },
    "task-060": {
      "title": "Audit Log: UI (Enhanced) - Activity Tab",
      "status": "completed",
      "completedAt": "2026-02-19T11:15:00Z",
      "summary": "Dedicated Activity tab in Dashboard with timeline view, icons per action type, filter by action type (dropdown), date range filter (1d/7d/30d), mobile-friendly responsive layout.",
      "commit": "34f7689"
    },
    "task-064": {
      "title": "E2E test: waitlist, signup, login flows",
      "status": "completed",
      "priority": "high",
      "description": "Use agent-browser to test full user flows: waitlist submission, signup, and login.",
      "completedAt": "2025-02-19",
      "notes": "All flows work: waitlist submits, signup creates account, login works. Minor: waitlist shows #undefined position."
    },
    "task-065": {
      "title": "Update OnHyper skill docs with advanced patterns",
      "status": "completed",
      "priority": "high",
      "description": "Update skill.html with slug resolution, X-App-Slug matching, response envelope handling, plan limits, and troubleshooting section."
    },
    "task-066": {
      "title": "Research: Leverage Hyper API with Railway adapters",
      "status": "completed",
      "priority": "medium",
      "description": "Research hyper63/hyper repo to understand their API, then create a proposal to build adapters for data, cache, and other backend services on Railway if supported.",
      "successCriteria": [
        "Research hyper63/hyper API and architecture",
        "Identify what adapters are available",
        "Assess Railway hosting capabilities",
        "Propose product design"
      ]
    },
    "task-073": {
      "title": "[Security] Fix XSS vulnerability in app rendering",
      "status": "completed",
      "priority": "high",
      "category": "Security",
      "completedAt": "2026-02-20",
      "reference": "CODE_REVIEW.md SECH-001",
      "description": "User-controlled HTML/CSS/JS is rendered directly into pages without sanitization. Malicious users could inject script tags, CSS keyloggers, or iframe attacks.",
      "file": "src/routes/render.ts",
      "line": "87-106",
      "notes": "Fixed - escapeHtml() and escapeJs() functions added to src/lib/security.ts, integrated into render.ts"
    },
    "task-074": {
      "title": "[Security] Implement Redis-backed rate limiting",
      "status": "pending",
      "priority": "high",
      "category": "Performance",
      "reference": "CODE_REVIEW.md SECM-001",
      "description": "Current in-memory rate limiting doesn't scale horizontally and loses state on restart. Need Redis-backed solution for production.",
      "file": "src/middleware/rateLimit.ts",
      "line": "13-25",
      "successCriteria": [
        "Replace Map-based storage with Redis",
        "Add Redis connection configuration",
        "Add maximum size limit to prevent memory exhaustion",
        "Maintain backward compatibility for single-server deployment"
      ]
    },
    "task-075": {
      "title": "[Security] Add CSRF protection for browser-based requests",
      "status": "pending",
      "priority": "high",
      "category": "Security",
      "reference": "CODE_REVIEW.md SECM-002",
      "description": "CORS is enabled globally without CSRF token protection. Browser-based sessions could be vulnerable to cross-site request forgery.",
      "file": "src/index.ts",
      "line": "25",
      "successCriteria": [
        "Implement CSRF tokens for browser-based form submissions",
        "Configure SameSite cookie attribute if cookies are used",
        "Consider using origin whitelist for CORS instead of open"
      ]
    },
    "task-076": {
      "title": "[Security] Fix timing attack in admin key comparison",
      "status": "completed",
      "priority": "high",
      "category": "Security",
      "completedAt": "2026-02-20",
      "reference": "CODE_REVIEW.md SECM-003",
      "description": "Admin key comparison has early length check that could leak timing information. Should use crypto.timingSafeEqual().",
      "file": "src/middleware/auth.ts",
      "line": "147-166",
      "notes": "Fixed - crypto.timingSafeEqual() implemented at lines 268, 282 in src/middleware/auth.ts"
    },
    "task-077": {
      "title": "[Architecture] Add schema validation library (Zod)",
      "status": "completed",
      "priority": "medium",
      "category": "Architecture",
      "completedAt": "2026-02-20",
      "reference": "CODE_REVIEW.md ARCH-001",
      "description": "Input validation is done manually with inconsistent patterns. Adopt Zod for schema validation across all endpoints.",
      "file": "Multiple",
      "notes": "Fixed - Zod added to package.json, src/lib/validation.ts created with validateBody() and validateQuery() middleware, used in routes"
    },
    "task-078": {
      "title": "[Performance] Add missing database indexes",
      "status": "completed",
      "priority": "medium",
      "category": "Performance",
      "completedAt": "2026-02-20",
      "reference": "CODE_REVIEW.md PERF-001",
      "description": "Several frequently queried columns lack indexes: audit_logs.action, audit_logs.resource_type, custom_secrets.user_id",
      "file": "src/lib/db.ts",
      "notes": "Fixed - indexes already existed: idx_audit_logs_action, idx_audit_logs_resource_type, idx_custom_secrets_user, idx_custom_secrets_name"
    },
    "task-079": {
      "title": "[Code Review] Complete code review documentation",
      "status": "completed",
      "priority": "high",
      "category": "Architecture",
      "completedAt": "2026-02-20T23:00:00Z",
      "description": "Formal code review of OnHyper codebase covering security, performance, and architecture issues.",
      "file": "docs/CODE_REVIEW.md",
      "summary": "Analyzed 47 TypeScript files. Build passes, 163 tests pass. Found 2 high, 3 medium, 2 low security issues. Found 3 medium, 2 low performance issues. Found 3 medium, 4 low architecture issues. Created follow-up tasks for all high-priority items."
    }
  }
}
