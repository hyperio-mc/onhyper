<section class="subpage-hero dashboard-hero">
  <span class="home-pill">Control Center</span>
  <h1>Manage apps, secrets, and activity in one secure workspace.</h1>
  <p>Everything your team needs to ship and operate agent-built apps safely.</p>
</section>

<section class="dashboard-shell">
  <div class="overview-bar">
    <div class="overview-stat">
      <span class="stat-value" id="stat-apps">0</span>
      <span class="stat-label">Apps</span>
    </div>
    <div class="overview-stat">
      <span class="stat-value" id="stat-secrets">0</span>
      <span class="stat-label">Keys</span>
    </div>
    <div class="overview-stat">
      <span class="stat-value" id="stat-calls">0</span>
      <span class="stat-label">Calls</span>
    </div>
    <div class="overview-token">
      <span class="token-label">API Token</span>
      <code id="api-token" class="token-value">Loading...</code>
      <button onclick="copyApiToken()" class="btn-icon" title="Copy token">üìã</button>
      <button id="generate-token-btn" onclick="generateApiToken()" class="btn-secondary btn-small">Generate</button>
    </div>
  </div>

  <div class="tabs-container">
    <div class="dashboard-tabs" role="tablist">
      <button type="button" class="tab active" role="tab" aria-selected="true" data-tab="apps">Apps</button>
      <button type="button" class="tab" role="tab" aria-selected="false" data-tab="keys">Keys</button>
      <button type="button" class="tab" role="tab" aria-selected="false" data-tab="analytics">Analytics</button>
      <button type="button" class="tab" role="tab" aria-selected="false" data-tab="activity">Activity</button>
      <button type="button" class="tab" role="tab" aria-selected="false" data-tab="settings">Settings</button>
      <span class="shortcuts-hint" title="Press ? for keyboard shortcuts">‚å®Ô∏è</span>
    </div>
  </div>

  <div class="tab-content">
  <div id="tab-apps" class="tab-panel active" role="tabpanel">
    <h2>My Apps</h2>
    <p class="text-muted">Publish web apps with secure API access</p>

    <div id="app-list">
      <p>Loading...</p>
    </div>

    <!-- Inline form removed - now using modal -->
  </div>

  <div id="tab-keys" class="tab-panel" role="tabpanel">
    <h2>API Keys</h2>
    <p class="text-muted">Store your API keys securely. They're encrypted and never exposed to browsers.</p>

    <div id="key-list">
      <p>Loading...</p>
    </div>

    <hr>

    <h3>Add New Key</h3>
    <form id="key-form" onsubmit="addKey(event)">
      <div class="form-group">
        <label for="key-name">API Provider</label>
        <select id="key-name" name="name" required>
          <option value="">Select...</option>
          <option value="OPENAI_API_KEY">ü§ñ OpenAI</option>
          <option value="ANTHROPIC_API_KEY">üß† Anthropic</option>
          <option value="OPENROUTER_API_KEY">üîÄ OpenRouter</option>
          <option value="SCOUT_API_KEY">üî≠ Scout</option>
          <option value="OLLAMA_API_KEY">ü¶ô Ollama</option>
        </select>
      </div>
      <div class="form-group">
        <label for="key-value">API Key</label>
        <input type="password" id="key-value" name="value" required placeholder="sk-...">
      </div>
      <button type="submit" class="btn-primary">Add Key</button>
    </form>

    <div class="info-box">
      <h4>Using Your Keys in Apps</h4>
      <p>Your apps call APIs through the proxy endpoints. Keys are injected server-side.</p>
      <code>fetch('/proxy/openai/chat/completions', { method: 'POST', body: ... })</code>
    </div>

    <hr>

    <h3>Custom API Backends</h3>
    <p class="text-muted">Connect to any API with custom authentication headers.</p>

    <div id="custom-key-list">
      <p>Loading...</p>
    </div>

    <button onclick="showAddCustomKeyModal()" class="btn-secondary">Add Custom API</button>
  </div>

  <div id="tab-analytics" class="tab-panel" role="tabpanel">
    <div class="analytics-header">
      <h2>Analytics</h2>
      <div class="analytics-controls">
        <select id="analytics-app-filter" onchange="loadAnalyticsData()">
          <option value="">All Apps</option>
        </select>
        <select id="analytics-days-filter" onchange="loadAnalyticsData()">
          <option value="7">Last 7 days</option>
          <option value="30" selected>Last 30 days</option>
          <option value="90">Last 90 days</option>
        </select>
      </div>
    </div>

    <div id="analytics-loading" class="analytics-loading">
      <p>Loading analytics...</p>
    </div>

    <div id="analytics-content" style="display: none;">
      <!-- Summary Cards -->
      <div class="analytics-cards">
        <div class="analytics-card">
          <div class="card-icon">üìä</div>
          <div class="card-data">
            <span class="card-value" id="analytics-total-events">0</span>
            <span class="card-label">Total Events</span>
          </div>
        </div>
        <div class="analytics-card">
          <div class="card-icon">üë•</div>
          <div class="card-data">
            <span class="card-value" id="analytics-unique-users">0</span>
            <span class="card-label">Unique Users</span>
          </div>
        </div>
        <div class="analytics-card">
          <div class="card-icon">üëÅ</div>
          <div class="card-data">
            <span class="card-value" id="analytics-views">0</span>
            <span class="card-label">Page Views</span>
          </div>
        </div>
        <div class="analytics-card">
          <div class="card-icon">‚ö°</div>
          <div class="card-data">
            <span class="card-value" id="analytics-calls">0</span>
            <span class="card-label">API Calls</span>
          </div>
        </div>
      </div>

      <!-- Daily Chart -->
      <div class="analytics-section">
        <h3>Daily Activity</h3>
        <div id="analytics-chart" class="analytics-chart">
          <!-- Chart will be rendered here -->
        </div>
      </div>

      <!-- Two Column Layout -->
      <div class="analytics-two-col">
        <!-- Top Events -->
        <div class="analytics-section">
          <h3>Top Events</h3>
          <div id="analytics-top-events" class="top-events-list">
            <!-- Events will be rendered here -->
          </div>
        </div>

        <!-- Per-App Breakdown -->
        <div class="analytics-section">
          <h3>Apps Overview</h3>
          <div id="analytics-apps-list" class="analytics-apps-list">
            <!-- Apps will be rendered here -->
          </div>
        </div>
      </div>

      <!-- Error Stats -->
      <div id="analytics-errors-section" class="analytics-section analytics-errors" style="display: none;">
        <h3>‚ö†Ô∏è Errors Detected</h3>
        <p>Your apps have encountered <span id="analytics-error-count">0</span> errors. <a href="#/dashboard?tab=apps">Check your apps</a> for details.</p>
      </div>
    </div>

    <div id="analytics-empty" class="analytics-empty" style="display: none;">
      <div class="empty-state-icon">üìà</div>
      <h3>No Analytics Yet</h3>
      <p>Analytics data will appear here once your apps start receiving traffic.</p>
      <a href="#/dashboard?tab=apps" class="btn-secondary">View Your Apps</a>
    </div>
  </div>

  <div id="tab-activity" class="tab-panel" role="tabpanel">
    <div class="activity-header">
      <h2>Activity</h2>
      <div class="activity-filters">
        <select id="activity-action-filter" onchange="filterActivity()">
          <option value="">All Actions</option>
          <option value="login">Logins</option>
          <option value="app_create">App Created</option>
          <option value="app_update">App Updated</option>
          <option value="app_delete">App Deleted</option>
          <option value="secret_create">Key Added</option>
          <option value="secret_delete">Key Deleted</option>
          <option value="password_change">Password Changed</option>
        </select>
        <select id="activity-date-filter" onchange="filterActivity()">
          <option value="">All Time</option>
          <option value="1d">Last 24 Hours</option>
          <option value="7d">Last 7 Days</option>
          <option value="30d">Last 30 Days</option>
        </select>
      </div>
    </div>
    
    <div id="activity-timeline">
      <p>Loading...</p>
    </div>
    
    <button id="load-more-activity-timeline" onclick="loadMoreActivityTimeline()" class="btn-secondary" style="display: none;">
      Load More
    </button>
  </div>

  <div id="tab-settings" class="tab-panel" role="tabpanel">
    <div class="settings-section">
      <h3>API Access</h3>
      <div class="setting-item">
        <label class="setting-label">
          <input type="checkbox" id="onhyper-api-enabled">
          <span class="setting-title">Enable OnHyper API access</span>
        </label>
        <p class="setting-description">
          Allow builder apps to access your configured APIs through OnHyper's secure proxy.
          This enables no-code tools and AI agents to use your API keys safely.
        </p>
      </div>
    </div>

    <div class="settings-section">
      <h3>Change Password</h3>
      <form id="change-password-form" onsubmit="changePassword(event)">
        <div class="form-group">
          <label for="current-password">Current Password</label>
          <input type="password" id="current-password" name="currentPassword" required 
                 placeholder="Enter your current password" autocomplete="current-password">
        </div>
        <div class="form-group">
          <label for="new-password">New Password</label>
          <input type="password" id="new-password" name="newPassword" required 
                 minlength="8" placeholder="Enter new password (min 8 characters)" 
                 autocomplete="new-password">
        </div>
        <div class="form-group">
          <label for="confirm-password">Confirm New Password</label>
          <input type="password" id="confirm-password" name="confirmPassword" required 
                 minlength="8" placeholder="Confirm new password" autocomplete="new-password">
        </div>
        <button type="submit" class="btn-primary">Update Password</button>
      </form>
    </div>

    <div class="settings-section">
      <h3>Activity</h3>
      <p class="text-muted">Recent account activity and actions.</p>
      <div id="activity-list">
        <p>Loading...</p>
      </div>
      <button id="load-more-activity" onclick="loadMoreActivity()" class="btn-secondary" style="display: none;">
        Load More
      </button>
    </div>
  </div>
  </div>
</section>
