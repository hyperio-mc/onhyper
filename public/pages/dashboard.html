<div class="hero">
  <h1>Dashboard</h1>
</div>

<!-- Sticky Overview Bar -->
<div class="overview-bar">
  <div class="overview-stat">
    <span class="stat-value" id="stat-apps">0</span>
    <span class="stat-label">Apps</span>
  </div>
  <div class="overview-stat">
    <span class="stat-value" id="stat-secrets">0</span>
    <span class="stat-label">Keys</span>
  </div>
  <div class="overview-stat">
    <span class="stat-value" id="stat-calls">0</span>
    <span class="stat-label">Calls</span>
  </div>
  <div class="overview-token">
    <span class="token-label">API Token</span>
    <code id="api-token" class="token-value">Loading...</code>
    <button onclick="copyApiToken()" class="btn-icon" title="Copy token">üìã</button>
    <button id="generate-token-btn" onclick="generateApiToken()" class="btn-secondary btn-small">Generate</button>
  </div>
</div>

<!-- Tab Navigation -->
<div class="tabs-container">
  <div class="dashboard-tabs" role="tablist">
    <button class="tab active" role="tab" aria-selected="true" data-tab="apps">
      Apps
    </button>
    <button class="tab" role="tab" aria-selected="false" data-tab="keys">
      Keys
    </button>
    <button class="tab" role="tab" aria-selected="false" data-tab="settings">
      Settings
    </button>
    <span class="shortcuts-hint" title="Press ? for keyboard shortcuts">‚å®Ô∏è</span>
  </div>
</div>

<!-- Tab Content -->
<div class="tab-content">
  <div id="tab-apps" class="tab-panel active" role="tabpanel">
    <h2>My Apps</h2>
    <p class="text-muted">Publish web apps with secure API access</p>

    <div id="app-list">
      <p>Loading...</p>
    </div>

    <!-- Inline form removed - now using modal -->
  </div>

  <div id="tab-keys" class="tab-panel" role="tabpanel">
    <h2>API Keys</h2>
    <p class="text-muted">Store your API keys securely. They're encrypted and never exposed to browsers.</p>

    <div id="key-list">
      <p>Loading...</p>
    </div>

    <hr>

    <h3>Add New Key</h3>
    <form id="key-form" onsubmit="addKey(event)">
      <div class="form-group">
        <label for="key-name">API Provider</label>
        <select id="key-name" name="name" required>
          <option value="">Select...</option>
          <option value="OPENAI_API_KEY">ü§ñ OpenAI</option>
          <option value="ANTHROPIC_API_KEY">üß† Anthropic</option>
          <option value="OPENROUTER_API_KEY">üîÄ OpenRouter</option>
          <option value="SCOUT_API_KEY">üî≠ Scout</option>
          <option value="OLLAMA_API_KEY">ü¶ô Ollama</option>
        </select>
      </div>
      <div class="form-group">
        <label for="key-value">API Key</label>
        <input type="password" id="key-value" name="value" required placeholder="sk-...">
      </div>
      <button type="submit" class="btn-primary">Add Key</button>
    </form>

    <div class="info-box">
      <h4>Using Your Keys in Apps</h4>
      <p>Your apps call APIs through the proxy endpoints. Keys are injected server-side.</p>
      <code>fetch('/proxy/openai/chat/completions', { method: 'POST', body: ... })</code>
    </div>

    <hr>

    <h3>Custom API Backends</h3>
    <p class="text-muted">Connect to any API with custom authentication headers.</p>

    <div id="custom-key-list">
      <p>Loading...</p>
    </div>

    <button onclick="showAddCustomKeyModal()" class="btn-secondary">Add Custom API</button>
  </div>

  <div id="tab-settings" class="tab-panel" role="tabpanel">
    <div class="settings-section">
      <h3>API Access</h3>
      <div class="setting-item">
        <label class="setting-label">
          <input type="checkbox" id="onhyper-api-enabled">
          <span class="setting-title">Enable OnHyper API access</span>
        </label>
        <p class="setting-description">
          Allow builder apps to access your configured APIs through OnHyper's secure proxy.
          This enables no-code tools and AI agents to use your API keys safely.
        </p>
      </div>
    </div>

    <div class="settings-section">
      <h3>Change Password</h3>
      <form id="change-password-form" onsubmit="changePassword(event)">
        <div class="form-group">
          <label for="current-password">Current Password</label>
          <input type="password" id="current-password" name="currentPassword" required 
                 placeholder="Enter your current password" autocomplete="current-password">
        </div>
        <div class="form-group">
          <label for="new-password">New Password</label>
          <input type="password" id="new-password" name="newPassword" required 
                 minlength="8" placeholder="Enter new password (min 8 characters)" 
                 autocomplete="new-password">
        </div>
        <div class="form-group">
          <label for="confirm-password">Confirm New Password</label>
          <input type="password" id="confirm-password" name="confirmPassword" required 
                 minlength="8" placeholder="Confirm new password" autocomplete="new-password">
        </div>
        <button type="submit" class="btn-primary">Update Password</button>
      </form>
    </div>
  </div>
</div>

<style>
.text-muted {
  color: var(--text-muted);
}

/* Tab Navigation */
.tabs-container {
  margin-bottom: 1.5rem;
}

.dashboard-tabs {
  display: flex;
  gap: 0;
  border-bottom: 2px solid var(--border-color, #e1e4e8);
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
}

.dashboard-tabs .tab {
  padding: 0.75rem 1.5rem;
  background: none;
  border: none;
  border-bottom: 2px solid transparent;
  margin-bottom: -2px;
  cursor: pointer;
  font-size: 1rem;
  font-weight: 500;
  color: var(--text-muted);
  transition: all 0.2s ease;
  white-space: nowrap;
}

.dashboard-tabs .tab:hover {
  color: var(--text-primary);
  background: var(--bg-alt);
}

.dashboard-tabs .tab.active {
  color: var(--accent-color, #0066ff);
  border-bottom-color: var(--accent-color, #0066ff);
}

.dashboard-tabs .tab:focus {
  outline: 2px solid var(--accent-color, #0066ff);
  outline-offset: 2px;
  border-radius: 4px 4px 0 0;
}

/* Tab Content */
.tab-content {
  min-height: 200px;
}

.tab-panel {
  display: none;
}

.tab-panel.active {
  display: block;
}

/* Settings Section */
.settings-section {
  background: var(--bg-alt);
  border-radius: 12px;
  padding: 24px;
  margin-bottom: 24px;
}

.settings-section h3 {
  margin: 0 0 20px 0;
  font-size: 1.1rem;
  color: var(--text-primary);
}

.setting-item {
  padding: 16px 0;
  border-bottom: 1px solid var(--border-color, #e1e4e8);
}

.setting-item:last-child {
  border-bottom: none;
  padding-bottom: 0;
}

.setting-label {
  display: flex;
  align-items: center;
  gap: 12px;
  cursor: pointer;
}

.setting-label input[type="checkbox"] {
  width: 20px;
  height: 20px;
  cursor: pointer;
  accent-color: var(--accent-color, #0066ff);
}

.setting-title {
  font-weight: 500;
  color: var(--text-primary);
}

.setting-description {
  margin: 8px 0 0 32px;
  color: var(--text-muted);
  font-size: 0.9rem;
  line-height: 1.5;
}

/* Mobile Responsive */
@media (max-width: 600px) {
  .tabs-container {
    margin-bottom: 0;
  }

  .settings-section {
    padding: 16px;
  }

  .setting-description {
    margin-left: 0;
  }
}

/* App Card Stats */
.app-card-stats {
  display: flex;
  gap: 12px;
  padding: 12px 0;
  border-top: 1px solid var(--border-color);
  border-bottom: 1px solid var(--border-color);
  margin: 12px 0;
}

.app-stat {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 0.85rem;
}

.app-stat .stat-icon {
  font-size: 1rem;
}

.app-stat .stat-value {
  font-weight: 600;
  color: var(--text-primary);
}

.app-stat .stat-label {
  color: var(--text-muted);
  font-size: 0.75rem;
}

.app-stat--error .stat-value {
  color: #dc2626;
}

/* Update app-card-actions for more buttons */
.app-card-actions {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
}

.app-card-actions .btn-secondary {
  flex: 1;
  min-width: 60px;
  text-align: center;
}
</style>